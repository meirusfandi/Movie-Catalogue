package com.meirusfandi.cataloguemovie.widget;import android.appwidget.AppWidgetManager;import android.content.Context;import android.content.Intent;import android.graphics.Bitmap;import android.os.Bundle;import android.widget.RemoteViews;import android.widget.RemoteViewsService;import com.bumptech.glide.Glide;import com.bumptech.glide.request.RequestOptions;import com.meirusfandi.cataloguemovie.BuildConfig;import com.meirusfandi.cataloguemovie.R;import com.meirusfandi.cataloguemovie.data.MovieModel;import com.meirusfandi.cataloguemovie.data.local.MovieHelper;import java.util.ArrayList;import java.util.concurrent.ExecutionException;public class StackViewsFactory implements RemoteViewsService.RemoteViewsFactory{    private Context context;    private ArrayList<MovieModel> movieModels;    StackViewsFactory(Context context, Intent intent) {        this.context = context;        int widgetID = intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);    }    @Override    public void onCreate() {    }    @Override    public void onDataSetChanged() {//        long idtoken = Binder.clearCallingIdentity();        MovieHelper movieHelper = new MovieHelper(context);        movieHelper.open();        movieModels = new ArrayList<>();        movieModels.addAll(movieHelper.getAllMovie());//        Binder.restoreCallingIdentity(idtoken);    }    @Override    public void onDestroy() {    }    @Override    public int getCount() {        return movieModels.size();    }    @Override    public RemoteViews getViewAt(int position) {        RemoteViews views = new RemoteViews(context.getPackageName(), R.layout.widget_item);        try {            Bitmap bitmap =   Glide.with(context)                    .asBitmap()                    .load(BuildConfig.POSTER_PATH+movieModels.get(position).getPoster())                    .apply(new RequestOptions().fitCenter())                    .submit()                    .get();            views.setImageViewBitmap(R.id.imageView, bitmap);        } catch (InterruptedException e){            e.printStackTrace();        } catch (ExecutionException e){            e.printStackTrace();        }        Bundle bundle = new Bundle();        bundle.putInt(FavoriteWidget.EXTRA_ITEM, position);        Intent intent = new Intent();        intent.putExtras(bundle);        views.setOnClickFillInIntent(R.id.imageView, intent);        return views;    }    @Override    public RemoteViews getLoadingView() {        return null;    }    @Override    public int getViewTypeCount() {        return 0;    }    @Override    public long getItemId(int position) {        return 0;    }    @Override    public boolean hasStableIds() {        return false;    }}